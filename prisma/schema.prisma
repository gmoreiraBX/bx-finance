generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  emailVerified Boolean      @default(false)
  name          String
  image         String?
  profile       Profile?
  billings      Billing[]
  tenant        Tenant?      @relation("TenantOwner")
  sessions      Session[]
  accounts      Account[]
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
}

model Account {
  id                     String    @id @default(cuid())
  userId                 String
  providerId             String
  accountId              String
  accessToken            String?
  refreshToken           String?
  idToken                String?
  accessTokenExpiresAt   DateTime?
  refreshTokenExpiresAt  DateTime?
  scope                  String?
  password               String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  user                   User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
}

model Session {
  id         String   @id @default(cuid())
  token      String   @unique
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt  DateTime
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Tenant {
  id           String         @id @default(cuid())
  name         String
  ownerId      String  @unique
  owner        User    @relation("TenantOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  bankAccounts BankAccount[]
  cards        Card[]
  transactions Transaction[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model BankAccount {
  id           String         @id @default(cuid())
  tenantId     String
  nickname     String
  transactions Transaction[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  tenant       Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Card {
  id           String         @id @default(cuid())
  tenantId     String
  nickname     String
  transactions Transaction[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  tenant       Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Transaction {
  id             String           @id @default(cuid())
  tenantId       String
  bankAccountId  String?
  cardId         String?
  amount         Decimal          @db.Decimal(12, 2)
  type           TransactionType
  category       String
  isFixed        Boolean          @default(false)
  referenceMonth DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  bankAccount    BankAccount?     @relation(fields: [bankAccountId], references: [id], onDelete: Cascade)
  card           Card?            @relation(fields: [cardId], references: [id], onDelete: Cascade)
}

model Billing {
  id                      String         @id @default(cuid())
  userId                  String
  planId                  String
  cycle                   BillingCycle
  status                  BillingStatus  @default(PENDING)
  provider                String         @default("asaas")
  providerCustomerId      String?
  providerSubscriptionId  String?
  providerPaymentLink     String?
  priceCents              Int?
  metadata                Json?
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  user                    User           @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Profile {
  id        String   @id @default(cuid())
  userId    String   @unique
  fullName  String?
  phone     String?
  document  String?
  company   String?
  timezone  String?  @default("America/Sao_Paulo")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum BillingCycle {
  MONTHLY
  YEARLY
}

enum BillingStatus {
  PENDING
  ACTIVE
  CANCELLED
  FAILED
}

enum TransactionType {
  INCOME
  EXPENSE
}
